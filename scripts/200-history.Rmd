---
title: "R Notebook"
output: html_notebook
---

```{r}
library(dplyr)
library(knitr)
library(tidyverse)
library(stringr)
library(here)
library(fs)
library(readxl)

source(here("scripts", "set_vars.R"))
```

```{r}
ctry <- read_rds(here("output_data","ctry_data3.rds"))
reg <- read_rds(here("output_data","reg_data3.rds"))
us <- read_rds(here("output_data","us_data3.rds"))
ctry_code <- read_csv(here("input_data","ctry_code.csv"))
```
```{r}
ctry_code <- data.frame(stat_can_ttl= c("Argentina",  "Australia",  "Austria",  "Belgium",  "Brazil",  "Bulgaria",  "China",  "Croatia",  "Czechia",  "Denmark",  "Egypt",  "Finland",  "France",  "Germany",  "Greece",  "Hong Kong",  "Hungary",  "India",  "Indonesia",  "Iran",  "Ireland",  "Israel",  "Italy",  "Japan",  "Korea, South",  "Macao",  "Malaysia",  "Mexico",  "Morocco",  "Netherlands",  "Norway",  "Philippines",  "Poland",  "Portugal",  "Russian Federation",  "Saudi Arabia",  "Singapore",  "South Africa, Republic of",  "Spain",  "Sweden",  "Switzerland",  "Taiwan",  "Thailand",  "TÃ¼rkiye",  "Ukraine",  "United Arab Emirates",  "United Kingdom",  "United States of America residents entering Canada",  "Viet Nam",  "Rest of Caribbean",  "Rest of Central America",  "Rest of Emerging Europe",  "Rest of Middle East",  "Rest of North Africa",  "Rest of North America",  "Rest of Northeast Asia",  "Rest of Oceania",  "Rest of South America",  "Rest of South Asia",  "Rest of Southeast Asia",  "Rest of Sub-Saharan Africa",  "Rest of Western Europe",  "Caribbean",  "Central America",  "Emerging Europe",  "North Africa",  "North America",  "Northeast Asia",  "Oceania",  "South America",  "South Asia",  "Southeast Asia",  "Sub-Saharan Africa",  "Western Europe",  "Middle East"),
                             IST_code=c("ARG",  "AUS",  "AUT",  "BEL",  "BRA",  "BGR",  "CHN",  "HRV",  "CZE",  "DNK",  "EGY",  "FIN",  "FRA",  "DEU",  "GRC",  "HKG",  "HUN",  "IND",  "IDN",  "IRN",  "IRL",  "ISR",  "ITA",  "JPN",  "KOR",  "MAC",  "MYS",  "MEX",  "MAR",  "NLD",  "NOR",  "PHL",  "POL",  "PRT",  "RUS",  "SAU",  "SGP",  "ZAF",  "ESP",  "SWE",  "CHE",  "TAW",  "THA",  "TUR",  "UKR",  "ARE",  "GBR",  "USA",  "VNM",  "RCAR",  "RCMA",  "REEU",  "RMES",  "RNAF",  "RNMA",  "RNEA",  "ROCE",  "RSMA",  "RSAS",  "RSEA",  "RSSA",  "RWEU",  "CAR",  "CAM",  "EEU",  "NAF",  "NMA",  "NEA",  "OCE",  "SAM",  "SAS",  "SEA",  "SSA",  "WEU",  "MES"))

print(ctry_code)
```

#2008-2023 overnight tourists from 49 IST countries visit to each provinces in Canada
```{r}
ctry_tour <- ctry %>%
  rbind(us) %>%
  filter(traveller_type == "Tourists (overnight)" & year <= 2023) %>%
  group_by(year, geo, country_of_residence, traveller_type) %>%
  summarise(value = sum(value, na.rm = TRUE), .groups = "drop") %>%
  ungroup() %>%
  left_join(ctry_code, by = c("country_of_residence" = "stat_can_ttl"))
```

#2008-2023 overnight tourists from regions visit to each provinces in Canada
```{r}
reg_tour <- reg %>%
  filter(traveller_type == "Tourists (overnight)" & year <= 2023) %>%
  group_by(year, geo, country_of_residence, traveller_type) %>%
  summarise(value = sum(value, na.rm = TRUE), .groups = "drop") %>%
  ungroup()
```

```{r}
colSums(is.na(ctry_tour))
colSums(is.na(reg_tour))
```

I'm worried that the country list and country-reg definition is different in IST and STATcan
I'm thinking about using ytd method to calculate 2024
